#include "main.h"

/* Math Constants */
#define GAUSS_CONST	   -1.83787706640935 
#define OVER_SQRT_2PI	0.39894228040143
#define OVER_SQRT_2     0.70710678118655
#define E				2.71828182845905

/* Internal Functions */
double GuassianPDF( double x );
double GaussianPDFInverse( double y );
double GuassianInverseCDF( double p );
double GaussianCDF( double x );
double randNormal(void);
double randNormalSlow(void);

/* Internal Variables */
#define	BLOCKS	10	 //number of trapazoids
#define A		0.01 //area of each trapazoid
#define X_START	2147483647	 //start to the first trapazoid

const double x[128] = {0.3958938266690988, 0.4551221594132193, 0.5029882210882071,
    0.5439742656569445, 0.5802709086410672, 0.6131335424721355,
    0.6433567812684077, 0.6714792984411817, 0.6978851513960972,
    0.7228589763636778, 0.7466183119213644, 0.7693336297093545,
    0.7911413250967589, 0.8121524635725834, 0.8324588573328086,
    0.8521374013194095, 0.8712532393336593, 0.8898621227294105,
    0.9080121988645145, 0.9257453885464256, 0.9430984618450287,
    0.9601038889373067, 0.9767905207082074, 0.9931841388167816,
    1.0093079044728754, 1.0251827277567724, 1.0408275739834323,
    1.0562597197265078, 1.0714949682478405, 1.0865478319348048,
    1.1014316877295245, 1.1161589102998242, 1.1307409867517877,
    1.1451886159462012, 1.1595117949038087, 1.1737198943289595,
    1.187821724919555, 1.2018255958419868, 1.2157393665170735,
    1.2295704926746711, 1.2433260674813666, 1.2570128584203013,
    1.2706373404991183, 1.2842057262769686, 1.2977239931309705,
    1.3111979081238403, 1.3246330507854167, 1.338034834079775,
    1.3514085237951923, 1.364759256565273, 1.3780920567051662,
    1.3914118520262833, 1.404723488775656, 1.4180317458315805,
    1.431341348275076, 1.4446569804466256, 1.4579832985894148,
    1.471324943173595, 1.4846865509908573, 1.4980727671046183,
    1.5114882567383514, 1.5249377171829137, 1.5384258898031273,
    1.551957572224297, 1.565537630780842, 1.579171013311711,
    1.5928627623909561, 1.606618029086561, 1.6204420873467198,
    1.634340349120177, 1.6483183803261854, 1.6623819178002899,
    1.6765368873547348, 1.6907894231070795, 1.7051458882479367,
    1.7196128974390144, 1.7341973410563387, 1.7489064115212294,
    1.7637476319940217, 1.7787288877435259, 1.7938584605498242,
    1.8091450665505227, 1.8245978980025381, 1.8402266695048384,
    1.8560416693146207, 1.8720538164931573, 1.8882747247415679,
    1.9047167739357038, 1.9213931905488333, 1.9383181383681847,
    1.9555068211758173, 1.9729755993875493, 1.9907421230409141,
    2.0088254840139936, 2.027246390967082, 2.0460273712621473,
    2.0651930050755283, 2.0847701981367965, 2.10478850108142,
    2.12528048540584, 2.146282188610697, 2.167833644519111,
    2.1899795192542246, 2.2127698793686834, 2.236261126736049,
    2.260517145913417, 2.2856107250604984, 2.31162533310583,
    2.3386573666838517, 2.366819025123547, 2.39624203796723,
    2.4270825694620917, 2.4595277789517476, 2.493804761106105,
    2.530192990057891, 2.569042067127458, 2.6107977571763907,
    2.6560414732124853, 2.7055525737070996, 2.7604114970838998,
    2.8221810252108104, 2.8932502063115018, 2.9775569161237767,
    3.0823403170211727, 3.223444187538558, 3.449414735505658,
    4.321841304289762};

void initializeNormal(void)
{
    exit(0);
}

double getRandomNormal(double sd, double mean)
{
    return randNormal()*sd + mean;
}

double randNormal(void)
{
    double multiplier;
    unsigned char r, n;
    
    r = 0;
    n = 1;
    getRandomBytes((char *)&r, 1);
    n &= r;
    r >>= 1;
    
    if( r == 127 )
        multiplier = randNormalSlow();
    else
        multiplier = x[r];
    
    return getRandom()*(-n);
}

double randNormalSlow(void)
{
    return 0.0;
}

double GaussianCDF( double x )
{
    return 0.5*erfc(x*-1*OVER_SQRT_2);
}

double GuassianInverseCDF( double p )
{
    return 0.0;
}

double GuassianPDF( double x )
{
	return OVER_SQRT_2PI * powf((float)E,(float)(-1/2*x*x));
}

double GaussianPDFInverse( double y )
{   
	return sqrt(log(y)*-2 + GAUSS_CONST);
}